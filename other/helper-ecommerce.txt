############# E-Commerece Methods ###################
    # Get Temporary User
        if (!function_exists('getTempUser')) {
            function getTempUser(){
                $temp_user      =   '';
                if(Session::has('temp_user')):
                    $temp_user  =  Session::get('temp_user');
                else:
                    Session::put('temp_user', Str::random(40));
                    $temp_user = Session::get('temp_user');
                endif;
        
                return $temp_user;
            }
        }
    # End Get Temporary User
    
    # Get Products
        if(!function_exists('getProducts')) {
            function getProducts($page_type='home', $search = '', $category_slug = ''){
        
                if($category_slug){
                    $category = Category::where('slug', $category_slug)->first();
                }
                
                # Prodcuts
                $products               =   Product::select('products.*', 'carts.id as cart_id',
                                            DB::raw("(CASE 
                                                            WHEN carts.id > 0  THEN true 
                                                            ELSE false 
                                                            END ) AS isInCart"),
                                            DB::raw("(CASE 
                                                            WHEN ( products.manage_stock = '1' AND products.stock_status = '1' AND products.quantity > 0 ) THEN true 
                                                            WHEN ( products.manage_stock = '0' ) THEN true 
                                                            ELSE false 
                                                            END ) AS isInStock"));
                                            $products->leftJoin('carts', function($join)
                                            {
                                              $join->on('carts.product_id', '=', 'products.id');
                                                if(Auth::guard('customer')->check()):
                                                        $join->on('user_id', DB::raw("'".Auth::guard('customer')->user()->id."'"));
                                                    else:
                                                        $join->on('session_id', DB::raw("'".getTempUser()."'"));
                                                    endif;
                                            });
                                            $products->where('products.parent_id', 0);
                                            $products->where('products.status', 1);
                                            
                                            if($page_type == 'home'):        
                                                $products->limit(8);
                                            endif;
                                            
                                            # Comment Because - List Js Filter - Getting products via category Slug
                                            // if($category_slug):        
                                            //     $products->whereRaw('FIND_IN_SET('.(int)$category->id.', products.category_ids)');
                                            // endif;
                                            # End Comment Because - List Js Filter - Getting products via category Slug
                                    
                                            $products->where('products.product_name', 'like',  '%' . $search .'%');
                $products               =   $products->get();
                # End Prodcuts
                
                $products->user_id                =   '';
                $products->isUser                 =   false;
         
                if(Auth::guard('customer')->check()):
                    $products->isUser                 =   true;
                    $products->user_id                =   Auth::guard('customer')->user()->id;
                else:
                    $products->temp_user_id             =   getTempUser();
                endif;
                
                return $products;
            }
        }
    # End Get Products
    
    # Get Cart Items
        if (!function_exists('getCartItems')) {
            function getCartItems(){
                    $sub_total                  =   0;
                    $delivery_charge            =   0;
      
                    $cart_items                 =   Product::select("products.id", "products.product_name", "products.slug", "products.manage_stock", "products.stock_status", 
                                                            "products.quantity", "products.mrp_price", "products.price as sale_price", "products.featured_image", "carts.qty")
                                                   ->join('carts', 'carts.product_id', '=', 'products.id')
                                                   ->where('products.status',1);
              
                                                    if(Auth::guard('customer')->check()){
                                                        $cart_items = $cart_items->where('user_id', Auth::guard('customer')->user()->id);
                                                    }
                                                    else {
                                                        $cart_items = $cart_items->where('session_id', getTempUser());
                                                    }
                          
                    $cart_items                 =   $cart_items->get();
      
                    foreach($cart_items as $cart_item):
                        $sub_total              +=   $cart_item->sale_price * $cart_item->qty;
                    endforeach;
      
            $cart_items->total_count            =   $cart_items->count();
            $cart_items->sub_total              =   $sub_total;
            $cart_items->delivery_charge        =   $delivery_charge;
            $cart_items->total                  =   $sub_total + $delivery_charge;
        return $cart_items;
      }
    }
    # End Get Cart Items
    
    # Update Cart Item
        if(!function_exists('update_cart')) {
            function update_cart($product_id, $quantity){
                if($quantity < 1):
                    return false;
                endif;
                
                $cart_items  =  Cart::where('product_id', $product_id);
                
                if(Auth::guard('customer')->check()):
                    $cart_items->where('user_id', Auth::guard('customer')->user()->id);
                else:
                    $cart_items->where('session_id', getTempUser());
                endif;
                
                $cart_items = $cart_items->update(['qty' => $quantity]);
                
                return $cart_items;
          }
        }
    # End Update Cart Item
    
    # Remove Cart Item
    if (!function_exists('remove_cart_item')) {
        function remove_cart_item($product_id){
            $cart_items  =  Cart::where('product_id', $product_id);
    
            if(Auth::guard('customer')->check()):
                $cart_items->where('user_id', Auth::guard('customer')->user()->id);
            else:
                $cart_items->where('session_id', getTempUser());
            endif;
    
            $result = $cart_items->delete();
            return $result;
        }
    }
    # End Remove Cart Item
    
    
    
    ############# End E-Commerece Methods ###############